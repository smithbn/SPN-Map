var map=new google.maps.Map(d3.select("#map").node(),{zoom:8,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_TOP},streetViewControl:false,panControl:false,mapTypeControl:false,center:new google.maps.LatLng(40.27015,-95.0100),mapTypeId:google.maps.MapTypeId.ROADMAP});var styles=[{elementType:'labels',stylers:[{visibility:'off'}]},{stylers:[{saturation:-99},{lightness:-65}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]}];map.mapTypes.set('styled',new google.maps.StyledMapType(styles));map.setMapTypeId('styled');function allSchools(){d3.json("orgs.json",function(data){var studentLayer=new google.maps.OverlayView();studentLayer.onAdd=function(){var layer=d3.select(this.getPanes().overlayLayer).append("div").attr("class","students");studentLayer.draw=function(){var projection=this.getProjection(),padding=13;var name=function(d){return(d.name)};var marker=layer.selectAll("svg").data(data.students).each(transform).enter().append("svg:svg").each(transform).attr("class","marker");var fill=d3.scale.category10();marker.append("svg:circle").attr("r",function(d){return(1.75*Math.sqrt(d.numbers))}).attr("cx",padding).attr("cy",padding).style("fill",function(d){return fill(d.funding)}).style("opacity",.50).attr("stroke",function(d){return(d.employees)=="Full-time"?"Yellow":null}).on("mouseover",function(){return d3.select(this).style("cursor","pointer")}).on("mouseout",function(){return d3.select(this).style("cursor","hand")});$('svg circle').tipsy({gravity:$.fn.tipsy.autoNS,html:true,title:function(){var d=this.__data__,c=fill(d.i);return'<a href="'+d.url+'"><b style="font-size:14px;color:yellow">'+d.name+'</b></a><a href="'+d.url+'"><img style="width:85px;" align="right" src="'+d.image+'"></a><br />Description: '+d.description+'<br /><br />'+d.name+' is a <b>'+d.type+'</b> with <b>'+d.funding+'</b> Funding and <b>'+d.numbers+'</b> '+d.employees+' Employees<br />Twitter:'+d.twitter+''}});function transform(d){d=new google.maps.LatLng(d.location[1],d.location[0]);d=projection.fromLatLngToDivPixel(d);return d3.select(this).style("left",(d.x-padding)+"px").style("top",(d.y-padding)+"px")}}};studentLayer.setMap(map)})};allSchools();function update(_schoolName){var newschool=_schoolName;var oldLayer=d3.selectAll(".students");oldLayer.selectAll("circle").transition().duration(1000).delay(function(){return Math.random()*1000}).style("display",function(d){return d.funding==newschool?null:"none"})};var schoolName={"All Categories":"all","Angel":"Angel","Bootstrapped":"Bootstrapped","Unknown":"Unknown"};d3.select("#calendarSelector").append("select").selectAll("option").data(d3.keys(schoolName)).enter().append("option").text(function(d){return d});d3.select("#calendarSelector select").selectAll("option").data(d3.values(schoolName)).attr("value",function(d){return d});d3.select("#calendarSelector select").on("change",function(){if(this.value!="all"){update(this.options[this.selectedIndex].value)}else{allSchools()}});